{% extends "base.html" %}
{% block title %}Add Product{% endblock %}

{% block content %}
<div class="container" style="padding: 15px;">
    <h2>Add Product</h2>

    <form method="POST" enctype="multipart/form-data">
        {% csrf_token %}

        <!-- Render form normally -->
        {{ form.as_p }}

        <button type="submit" class="btn btn-primary">Save Product</button>
    </form>
</div>

<!-- ========== SUBCATEGORY AUTO-LOADER ========== -->
<script>
document.addEventListener("DOMContentLoaded", function () {
    const categoryField = document.getElementById("id_category");
    const subcategoryField = document.getElementById("id_subcategory");

    if (!categoryField || !subcategoryField) return;

    categoryField.addEventListener("change", function () {
        const categoryID = this.value;

        if (!categoryID) {
            subcategoryField.innerHTML = "<option value=''>---------</option>";
            return;
        }

        fetch(`/get-subcategories/${categoryID}/`)
            .then(response => response.json())
            .then(data => {
                subcategoryField.innerHTML = "";

                if (data.subcategories.length === 0) {
                    subcategoryField.innerHTML = "<option value=''>No subcategories</option>";
                } else {
                    data.subcategories.forEach(sub => {
                        subcategoryField.innerHTML += 
                            `<option value="${sub.id}">${sub.name}</option>`;
                    });
                }
            })
            .catch(error => console.error("Error loading subcategories:", error));
    });
});
</script>
{% endblock %}
